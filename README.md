



















/*
ä»¥ä¸‹ã«ã€`@simplewebauthn/server` ã®ä¸»ãªãƒ«ãƒ¼ãƒãƒ³ï¼ˆ`verifyRegistrationResponse`, `verifyAuthenticationResponse`ï¼‰ã§ç™ºç”Ÿã—å¾—ã‚‹ **ã‚¨ãƒ©ãƒ¼å (`err.name`) ã¨æ„å‘³ãƒ»å¯¾å‡¦æ³•** ã®ãƒãƒˆãƒªã‚¯ã‚¹ã‚’ç¤ºã—ã¾ã™ï¼š

---

### âœ… SimpleWebAuthn ã®ã‚¨ãƒ©ãƒ¼ãƒãƒˆãƒªã‚¯ã‚¹ä¸€è¦§

| `err.name`          | å…¸å‹çš„ãªåŸå›                                                | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®èª¬æ˜             | å¯¾å‡¦ï¼ˆHTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼‰                       |
| ------------------- | ---------------------------------------------------- | -------------------- | ------------------------------------ |
| `InvalidStateError` | åŒã˜èªè¨¼å™¨ãŒã™ã§ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹                                     | ã€Œã™ã§ã«ç™»éŒ²æ¸ˆã¿ã®èªè¨¼å™¨ã§ã™ã€      | `400 Bad Request` (`_400`)           |
| `TypeError`         | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰é€ã‚‰ã‚ŒãŸ JSON ã®æ§‹é€ ã«å•é¡Œã‚ã‚Šã€ã¾ãŸã¯ undefined å€¤ãªã©         | ã€Œãƒ‡ãƒ¼ã‚¿å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€     | `400 Bad Request` (`_400`)           |
| `SecurityError`     | Origin, RPID ãŒä¸€è‡´ã—ãªã„ï¼æ”»æ’ƒã¨è¦‹ãªã•ã‚Œã‚‹å…¥åŠ›                       | ã€Œã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã«é•åã—ã¦ã„ã¾ã™ã€ | `400 Bad Request` (`_400`)           |
| `NotAllowedError`   | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç™»éŒ²ï¼èªè¨¼ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ãŸã€ã¾ãŸã¯ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ                         | ã€Œæ“ä½œãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸã€      | `401 Unauthorized` (`_401`)          |
| `ConstraintError`   | èªè¨¼å™¨ãŒé¸æŠæ¡ä»¶ã‚’æº€ãŸã•ãªã„ï¼ˆe.g., `residentKey: required` ãªã®ã«éå¯¾å¿œï¼‰ | ã€Œå¯¾å¿œã—ã¦ã„ãªã„èªè¨¼å™¨ã§ã™ã€       | `400 Bad Request` (`_400`)           |
| `UnknownError`      | å†…éƒ¨çš„ã«ä½•ã‹ä¸æ˜ãªåŸå› ã§å¤±æ•—                                       | ã€Œä¸æ˜ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€      | `500 Internal Server Error` (`_500`) |
| `AbortError`        | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ“ä½œã‚’ä¸­æ­¢ã—ãŸ                                         | ã€Œèªè¨¼æ“ä½œãŒä¸­æ–­ã•ã‚Œã¾ã—ãŸã€       | `401 Unauthorized` (`_401`)          |
| `DOMException`      | ä¸Šè¨˜ã¨é¡ä¼¼ã€WebAuthn ãƒ¬ãƒ™ãƒ«ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚„ä¸­æ–­ãªã©ãŒç™ºç”Ÿ                     | ã€Œãƒ–ãƒ©ã‚¦ã‚¶å´ã§æ“ä½œãŒä¸­æ–­ã•ã‚Œã¾ã—ãŸã€   | `401 Unauthorized` (`_401`)          |

---

### ğŸ›  å®Ÿè£…ã§ã®ä½¿ã„æ–¹ï¼ˆä¾‹ï¼‰

```js
.catch(err => {
  console.error('WebAuthn error:', err.name, err.message);

  switch (err.name) {
    case 'InvalidStateError':
      return _400(S, 'ãã®èªè¨¼å™¨ã¯ã™ã§ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™');
    case 'TypeError':
    case 'SecurityError':
    case 'ConstraintError':
      return _400(S, err.message);
    case 'NotAllowedError':
    case 'AbortError':
    case 'DOMException':
      return _401(S, 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ“ä½œã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ');
    case 'UnknownError':
    default:
      return _500(S);
  }
});
```

---

### ğŸ’¡è£œè¶³

* ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ `startRegistration()` ã‚„ `startAuthentication()` ãŒè¿”ã™ Promise ã®ä¸­ã§ã‚‚åŒã˜ã‚ˆã†ãª `err.name` ãŒå‡ºã¾ã™ã€‚
* `@simplewebauthn/browser` ã‚’ä½¿ã£ã¦ã„ã‚Œã°ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã‚‚ `error.name` ã‚’ä½¿ã£ã¦ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’æ”¹å–„ã§ãã¾ã™ã€‚

---

ã‚‚ã£ã¨è©³ç´°ãªã‚±ãƒ¼ã‚¹ï¼ˆe.g., FIDO2 error code, CTAP error code ã«ç´ã¥ã‘ã‚‹ãªã©ï¼‰ãŒå¿…è¦ã§ã‚ã‚Œã°ã€ãŠæ°—è»½ã«ã©ã†ãã€‚
*/
